name: '.Platform: Sync Docs/Wiki'

trigger:
  branches:
    include:
      - main
  paths:
    include:
      - 'docs/wiki/**'

variables:
  - group: 'test'
  - template: '/.azuredevops/pipelineVariables/global.variables.yml'
  - name: pipelinePrincipalGitUserName
    value: 'CARMLPipelinePrincipal'
  - name: pipelinePrincipalGitUserEmail
    value: 'CARML@noreply.github.com'
  - name: wikiRepository
    value: '$(Build.Repository.Uri).wiki'

jobs:
  - job: Update_module_tables
    pool:
      ${{ if ne('$(vmImage)', '') }}:
        vmImage: '$(vmImage)'
      ${{ if ne('$(poolName)', '') }}:
        name: '$(poolName)'
    steps:
      - checkout: self
        displayName: Checkout Source Repo
        persistCredentials: true
      # Create a variable
      - task: PowerShell@2
        displayName: 'Update general ReadMe'
        name: setvarStep
        inputs:
          targetType: inline
          pwsh: true
          script: |
            # $wikiRepository = '$(Build.Repository.Uri)' + '.wiki'
            # Write-Verbose $wikiRepository -Verbose
            # echo "##vso[task.setvariable variable=wikiRepositoryVar;isOutput=true]$wikiRepository" # remember to use double quotes


            git config --global user.email '$(pipelinePrincipalGitUserEmail)'
            git config --global user.name '$(pipelinePrincipalGitUserName)'
            $repositoryEndpoint= 'https://' + '$(PAT)' + '@github.com/' + '$(Build.Repository.Name)' + '.wiki'
            Write-Verbose $repositoryEndpoint -Verbose
            git clone https://{yourPAT}@dev.azure.com/yourOrgName/yourProjectName/_git/yourRepoName
            # Write-Verbose '$(Build.SourceBranch)' -Verbose
            # git add .
            # git commit -m "Push updated Readme file(s)"
            # git push $(Build.Repository.Uri) HEAD:$(Build.SourceBranch)
